Using the DiVinE commandline interface
======================================

The main interface to DiVinE is the command-line tool simply called
`divine`. Additionally, some of the functionality is also available via
`divine.ide` which is documented separately. DiVinE supports a number of input
languages and not all features are available with all input languages. These
limitations are documented here. Additionally, since DiVinE has many build
dependencies and needs substantial amount of RAM and disk space to compile,
many features can be disabled at compile time to reduce some of these
requirements. The binary will normally give you an explanation if you request
an operation that has been disabled at compile time. To get a list of options
your `divine` binary has been compiled with, simply issue

    $ divine --version
    DiVinE version 2.91
    Version: 2.91
    Build-Date: 2013-01-18, 09:22 UTC
    Pointer-Width: 64
    Debug: enabled
    Compile-Flags: POSIX O_DVE O_HASH_COMPACTION O_COIN O_LLVM O_LTL3BA
    MPI-Version: n/a
    Architecture: Intel(R) Core(TM) i7-3520M CPU @ 2.90GHz

Synopsis
--------

    divine info <model file>
    divine combine [-f <formula file>] <model file>
    divine compile [--cesmi|--llvm] <model file>
    divine draw [...] <model file>
    divine metrics [...] <model file>
    divine verify [...] <model file>

Printing model metadata
-----------------------

    divine info {model}

To obtain basic data about a model, use `divine info`. The key part of the
information provided is the list of properties available in the model, and the
name of a property needs should be passed to the `--property` option of `draw`,
`metrics` or `verify` subcommands:

    $ divine info examples/dve/peterson-liveness.dve
    Available properties:
     * deadlock: deadlock freedom
     * assert: assertion safety
     * LTL: BÃ¼chi neverclaim property

In this case, the model has three properties, `deadlock`, `assert` and `LTL`
(the last being a neverclaim property generated from an LTL formula, see
section on `divine combine` below).

Using LTL properties
--------------------

    divine combine [-f formula.ltl] [-p N] [-o] [-q] model.dve
    divine combine [-f formula.ltl] [-p N] [-o] [-q] model.mdve [P1=VAL] [P2=VAL] ...

Some of the input languages have intrinsic support for specifying LTL
properties. In these cases, all suitable LTL properties are automatically made
available for model checking via the `--property` switch to `divine verify`
(see below). However, since the DVE language currently lacks support for
specifying LTL directly, the formulas need to be provided in a separate file
with an `.ltl` suffix. The `combine` subcommand can be used to translate the
LTL formula into an Buchi automaton which is then included in the DVE file. One
DVE file is generated for each LTL formula found in the `.ltl` file.

Without the -p (--property) and -o (--stdout) options, the output of `divine
combine` looks like this:

    $ divine combine peterson.dve -f peterson.ltl
    peterson.prop1.dve: G(p0cs->F(!p0cs))
    peterson.prop2.dve: G((!p0cs)->Fp0cs)
    peterson.prop3.dve: GFsomeoneincs

    $ divine verify peterson.prop1.dve
    ...

To pick a specific formula, use -p N. In this case, -o can be used to direct
the generated model to standard output.

Configuring the parallel model checking engine
----------------------------------------------

Many of the algorithms divine can use are parallel and optionally
distributed. Both `metrics` and in common cases the `verify` subcommand will
use a parallel algorithm to explore the state space of the system. All the
parallel algorithms have a number of parameters in common, and we will discuss
them in this section.

    divine {metrics|verify} [--statistics [--curses]]
                            [-w N|--workers=N]
                            [--max-memory=N]
                            [--max-time=N]
                            [--disk-fifo=N]
                            [--seed=N]
                            [-i N|--initial-table=N]
                            [--hash-compaction]

`-w N | --workers=N`
:    The number of threads to use for verification. The default is 2. For optimal
     performance, each thread should get one otherwise mostly idle CPU
     core. Your mileage may vary with hyper-threading (it is best to run a few
     benchmarks on your system to find the best configuration).

`--max-memory=N`
:    Limit the amount of memory `divine` is allowed to allocate. This is mainly
     useful to limit swapping. When the verification exceeds available RAM, it
     will usually take extremely long time to finish and put prohibitive strain
     on the IO subsystem. It is recommended that you do not allow `divine` to
     swap excessively, either using this option or by other means.

`--max-time=N`
:    Put a limit of N seconds on the maximal running time.

`--disk-fifo=N`
:    Most of the memory used by the verifier is split between hash tables and
     queues. This option tells `divine` to use disk storage for long queues,
     since the impact of high latency is much smaller for queues than it is for
     hash tables. This allows more of RAM to be used for hash tables, improving
     overall performance for large models. **Currently not implemented.**

`--statistics [--curses]`
:    Print realtime statistics during verification, optionally using curses for
     neater output. Useful as entertainment, for diagnosing performance issues
     and to impress laymen.

State space metrics & visualisation
-----------------------------------

    divine metrics [--reduce=R] [--no-reduce] [--fair] [--report]
                   [engine options]
                   <model file>

The `metrics` sub-command runs a simple reachability on the entire state space
of a system, reporting summary statistics. This is the most efficient 

    divine draw [--distance=N] [--draw-trace=N,N,N...]
                [-l|--labels|--trace-labels]
                [--bfs-layout]
                [--reduce=R] [--no-reduce] [-f|--fair]

Model checking
--------------

    divine verify [--reachability|--owcty|--map|--nested-dfs]
                  [--property=<name>]
                  [--fair]
                  [--reduce=<reduction>]
                  [--report]
                  [--no-counterexample]
                  [--display-counterexample]
                  [engine options]
                  <model file>

This command is the main workhorse of model checking. It automatically selects
an appropriate algorithm for model checking based on the property type, and an
appropriate model loader / state space generation backend according to the
input file.

    $ divine verify examples/dve/peterson-liveness.dve --property=deadlock --no-reduce
      searching... 	736677 states, 2848427 edges
     ===================================== 
               The property HOLDS          
     ===================================== 

### Options

`--reachability, --owcty, --map, --nested-dfs`
:    Override the algorithm to use.

`--property=name`
:    Select which property to model-check. Use `divine info` to
     obtain a list of properties available in any given model. Defaults to
     `deadlock`.

`--fair`
:    Only consider runs that are weakly fair. This option is only
     currently available for DVE models and is mainly useful when checking LTL
     properties. This avoids counterexamples which rely on one of the processes of
     the system never making any progress even though it is not blocked.

`--reduce=X, --no-reduce`
:    This option directs the model checker to use heuristics which
     usually make the process faster and/or use less memory. Not all reductions
     are available with all model types. The default is to enable all reductions,
     namely `tau+,taustore,heap,por`. To disable state space reductions, specify
     `--no-reduce`. In addition, `tau` is available as a weaker alternative to
     `tau+`. The `tau`, `taustore` and `heap` reductions are only available with
     the LLVM backend. The `por` reduction is available with CoIn and DVE inputs
     and may be available with some CESMI models. To specify multiple reductions,
     provide them as a comma-separated list.

`--no-counterexample`
:    Disable generation of counterexamples. This is mainly
     useful for benchmarking verification speed.

`--report`
:    At the end of a verification run, produce a comprehensive,
     machine-readable report.
