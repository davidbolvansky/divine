# -*- sh -*-

not() { "$@" && exit 1 || return 0; }

for_dve_small() {
    wrapper=$1; shift

    check clear
    run $wrapper data/test1.dve "$@"
    check ltl_invalid
    check statespace 7 15 3 0
    $extracheck data/test1.dve

    check clear
    run $wrapper data/test2.dve "$@"
    check ltl_valid
    check owcty_sizes 2 2 0
    check statespace 3 3 2 2
    $extracheck data/test2.dve

    check clear
    run $wrapper data/test3.dve "$@"
    check ltl_valid
    check owcty_sizes 2 5 0
    check statespace 6 13 2 0
    $extracheck data/test3.dve

    check clear
    run $wrapper data/test4.dve "$@"
    check ltl_invalid
    check owcty_sizes 1 4 1
    check statespace 5 6 1 0
    $extracheck data/test4.dve

    check clear
    run $wrapper data/test5.dve "$@"
    check ltl_invalid
    check owcty_sizes 1 4 1
    check statespace 5 6 1 0
    $extracheck data/test5.dve

    check clear
    run $wrapper data/test6.dve "$@"
    check ltl_invalid
    check owcty_sizes 2 6 1 5 1
    check statespace 6 7 2 0
    $extracheck data/test6.dve
}

dve_small() {
    for_dve_small identity "$@"
}

dve_compiled_small() {
    for_dve_small dve_compile "$@"
}

llvm_small() {
    :
}

coin_small() {
    :
}

all_small() {
    dve_small "$@"
    llvm_small "$@"
    coin_small "$@"
}

chmod +x check run
PATH=".:$PATH"
extracheck=:
set -vex -o pipefail
trap "check debris" EXIT

